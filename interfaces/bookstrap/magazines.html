<%inherit file="base.html" />
<%!
    from lazylibrarian import database
%>

<%def name="headerIncludes()">

    <div id="subhead_container">
        <form action="addMagazine" method="get" class="form-inline">    
        <input type="hidden" name="search" value="magazine">
        <div id="subhead_menu">
            <a href="forceSearch?source=magazines" class="button btn btn-sm btn-primary"><i class="fa fa-search"></i> Force Search</a>
            <a href="forceProcess?source=magazines" class="button btn btn-sm btn-primary">Force Post-Processing</a>
            <a href="magazineScan" class="button btn btn-sm btn-primary">Library Scan</a>
            <a href="pastIssues?whichStatus='Skipped'" class="button btn btn-sm btn-primary">Past Issues</a>
            <div class="pull-right">
                <input type="text" placeholder="Magazine Title" name="title" class="form-control input-sm">
                <select name="frequency" class="form-control input-sm">
                    <option value="Weekly">Weekly</option>
                    <option value="BiWeekly">BiWeekly</option>
                    <option value="Monthly">Monthly</option>
                    <option value="BiMonthly">BiMonthly</option>
                    <option value="Quarterly">Quarterly</option>
                    <option value="Keyword">Keyword</option>
                </select>
                <input type="submit" value="+Magazine" class="btn btn-sm btn-primary">
            </div>
        </div>
        </form>
    </div>
</%def>

<%def name="body()">

    <form action="markMagazines" method="get" class="form-inline">
    <h1>Magazines</h1>
    <div class="indented">        
            <div class="form-group">
                <label for="action" class="">Mark selected as</label>
                <select class="markMagazines form-control" id="action" name="action">
                    <option value="Active">Active</option>
                    <option value="Paused">Paused</option>
                    <option value="Reset">Reset</option>
                    <option value="Delete">Delete</option>
                </select>                
            </div>
            <input type="submit" class="markMagazines btn btn-primary" value="Go">
    </div>
    <p>&nbsp;</p>

    <div class="table-responsive"></div>
        <table class="display table table-striped table-hover table-bordered" id="book_table">
            <thead>
                <tr>
                    <th class="select"><input type="checkbox" onClick="toggleAll(this)" /></th>
                    <th class="magtitle">Title</th>
                    <th class="frequency">Frequency</th>
                    <th class="seriesOrder">Num</th>
                    <th class="lastacquired">Acquired</th>
                    <th class="issuedate">Issue Date</th>
                    <th class="status">Status</th>
                    <th class="issue">Issue</th>
                </tr>
            </thead>

            <tbody>
            %for result in magazines:
                    <tr class="gradeZ">
                        <td class="select"><input type="checkbox" name="${result['Title']}" id="${result['Title']}" class="checkbox" /></td>
                        <td class="magtitle"><BR>${result['Title']}<BR><BR></td>
                        <td class="frequency">${result['Frequency']}</td>
                        <!-- <td id="regex"> -->      
                            <!-- <form action="updateRegex" method="get"><input type="hidden" name="title" value="${result['Title']}">-->
                                <!-- <select name="regex">-->
                                    <!-- <option selected="selected">${result['Regex']}</option>-->
                                    <!-- <option value="RegexA">(DD) MonthName YYYY</option>-->
                                    <!-- <option value="RegexB">YYYY-MM</option>-->
                                    <!-- <option value="RegexC">MonthName DD YYYY</option>-->
                                <!-- </select>-->
                                <!-- <input type="submit" value="Go">-->
                            <!-- </form>-->
                        <!-- </td>-->
                        <td class="seriesOrder">${result['Count']}</td>
                        <td class="lastacquired">${result['LastAcquired']}</td>
                        <td class="issuedate">${result['IssueDate']}</td>
                        <td class="status">${result['Status']}</td>
                        %if result['IssueStatus'] == 'Open':
                            <td class="issue"><a class="button green" href="openMag?bookid=${result['Title']}" target="_self">${result['IssueStatus']}</a></td>
                        %else:
                            %if result['IssueStatus'] == 'Wanted':
                                <td class="issue"><a class="button red" href="searchForMag?bookid=${result['Title']}" target="_self"><span class="a">${result['IssueStatus']}</span><span class="b">Search</span></a></td>
                            %else:
                                %if result['IssueStatus'] == 'Snatched':
                                    <td class="issue"><a class="button">${result['IssueStatus']}</a></td>
                                %else:
                                    <td class="issue"><a class="button grey">${result['IssueStatus']}</a></td>
                                %endif
                            %endif
                        %endif
                    </tr>
            %endfor
            </tbody>
        </table>
    </form>

</div>
</%def>

<%def name="headIncludes()">
    
</%def>

<%def name="javascriptIncludes()">
    <script>
        
    $(document).ready(function()
    {

        $('#book_table').dataTable(
            {
                "aoColumns": [
                    null,
                    null,
                    null,
                    null,
                    null,
                    null,
                    null,
                    null
                    ],
                "oLanguage": {
                    "sLengthMenu":"Show _MENU_ magazines per page",
                    "sEmptyTable": "No magazines found",
                    "sInfo":"Showing _START_ to _END_ of _TOTAL_ results",
                    "sInfoEmpty":"Showing 0 to 0 of 0 books",
                    "sInfoFiltered":"(filtered from _MAX_ total magazines)"},
                "sPaginationType": "full_numbers",
                "bStateSave": true,
                "aLengthMenu": [[5, 10, 15, 25, 50, 100, -1], [5, 10, 15, 25, 50, 100, "All"]],
                "iDisplayLength": 10,
            });
            $('.dataTables_filter input').attr("placeholder", "Seach table here");
    });
    </script>
</%def>
